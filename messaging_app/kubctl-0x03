#!/bin/bash

echo "Applying updated blue deployment..."
kubectl apply -f messaging_app/blue_deployment.yaml

echo "📡 Monitoring rollout status..."
kubectl rollout status deployment/django-blue

echo "Testing app availability during update..."
for i in {1..20}; do
  curl -s http://192.168.49.2:30970/api/
  if [ $? -eq 0 ]; then
    echo "[$i] App is responding"
  else
    echo "[$i] App is NOT responding"
  fi
  sleep 2
done

echo "🔍 Verifying updated pods..."
kubectl get pods -l app=messaging
